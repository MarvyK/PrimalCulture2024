---
import MainLayout from "../layouts/Layout.astro";
import "../css/styles.css";
import "../css/bookings.css";

export const prerender = true;
---

<MainLayout>
  <div class="container">
    <div class="booking-container">
      <h1>Tattoo Studio Bookings</h1>

      <div class="main-content">
        <!-- Success Message -->
        <div id="successMessage" class="alert alert-success" style="display: none;">
          ✓ Thank you! Your booking request has been sent. We'll get back to you soon!
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="alert alert-error" style="display: none;">
          ✗ Something went wrong. Please try again or contact us directly.
        </div>

        <!-- Booking Form Section -->
        <section class="booking-form-section">
          <form id="bookingForm">
            <!-- Web3Forms Configuration -->
            <input type="hidden" name="access_key" value="770e6620-4244-4cfd-b48b-52b1fa4cabe2" />
            <input type="hidden" name="subject" value="New Tattoo Booking Request" />
            <input type="hidden" name="from_name" value="Tattoo Studio Booking" />

            <div class="form-group">
              <label>Name: <span style="color: #ff6b6b;">*</span></label>
              <input type="text" name="name" id="name" required />
            </div>

            <div class="form-group">
              <label>Email: <span style="color: #ff6b6b;">*</span></label>
              <input type="email" name="email" id="email" required />
            </div>

            <div class="form-group">
              <label>Phone Number: <span style="color: #ff6b6b;">*</span></label>
              <input type="tel" name="phone" id="phone" required />
            </div>

            <div class="form-group">
              <label>Artist: <span style="color: #ff6b6b;">*</span></label>
              <select name="artist" id="artist" required>
                <option value="">Select an artist</option>
                <option value="clinton">Clinton</option>
                <!-- <option value="tripple-lee">Tripple Lee</option> -->
                <option value="any">It doesn't matter. I trust you guys</option>
              </select>
            </div>

            <div class="form-group">
              <label>Preferred Date: <span style="color: #ff6b6b;">*</span></label>
              <input type="date" name="booking_date" id="date" required />
            </div>

            <div class="form-group">
              <label>Preferred Time: <span style="color: #ff6b6b;">*</span></label>
              <select name="time" id="time" required>
                <option value="">Select a time</option>
                <option value="09:00">09:00 AM</option>
                <option value="10:00">10:00 AM</option>
                <option value="11:00">11:00 AM</option>
                <option value="12:00">12:00 PM</option>
                <option value="13:00">01:00 PM</option>
                <option value="14:00">02:00 PM</option>
                <option value="15:00">03:00 PM</option>
                <option value="16:00">04:00 PM</option>
                <option value="17:00">05:00 PM</option>
              </select>
            </div>

            <div class="form-group">
              <label>Tattoo Description: <span style="color: #ff6b6b;">*</span></label>
              <textarea 
                name="description" 
                id="description" 
                required 
                rows="4"
                placeholder="Describe your tattoo idea, placement, style preferences, etc."
              ></textarea>
            </div>

            <div class="form-group">
              <label>Size (approximate): <span style="color: #ff6b6b;">*</span></label>
              <select name="size" id="size" required>
                <option value="">Select size</option>
                <option value="small">Small (&lt; 5cm)</option>
                <option value="medium">Medium (6cm - 10cm)</option>
                <option value="large">Large (11cm - 20cm)</option>
                <option value="extra-large">Extra Large (&gt; 21cm)</option>
              </select>
            </div>

            <div class="form-group">
              <label>Reference Images (optional):</label>
              <input 
                type="text" 
                name="reference_images" 
                id="reference"
                placeholder="Link to reference images (Google Drive, Dropbox, etc.)"
              />
            </div>

            <div class="form-group">
              <label>Additional Notes:</label>
              <textarea 
                name="additional_notes" 
                id="additional" 
                rows="3"
                placeholder="Any allergies, special requests, or questions?"
              ></textarea>
            </div>

            <button type="submit" class="submit-button" id="submitButton">
              Book Appointment
              <span id="loadingSpinner" class="loading-spinner" style="display: none;"></span>
            </button>
          </form>
        </section>

        <!-- Bookings Display Section (commented out as it requires backend) -->
        <!-- <section class="bookings-display-section">
          <h2 style="color: #374151; margin-bottom: 20px;">Current Bookings</h2>
          <div id="bookingsList"></div>
        </section> -->
      </div>
    </div>
  </div>

  <style>
    .alert {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 500;
      animation: slideIn 0.3s ease;
    }

    .alert-success {
      background: rgba(76, 175, 80, 0.1);
      border: 2px solid #4caf50;
      color: #4caf50;
    }

    .alert-error {
      background: rgba(244, 67, 54, 0.1);
      border: 2px solid #f44336;
      color: #f44336;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .loading-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #ffffff;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 0.6s linear infinite;
      margin-left: 8px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>

  <script>
    const form = document.getElementById('bookingForm');
    const submitBtn = document.getElementById('submitButton');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const successMessage = document.getElementById('successMessage');
    const errorMessage = document.getElementById('errorMessage');
    const dateInput = document.getElementById('date');

    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    dateInput.setAttribute('min', today);

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Show loading state
      submitBtn.disabled = true;
      loadingSpinner.style.display = 'inline-block';
      const originalText = submitBtn.childNodes[0].textContent;
      submitBtn.childNodes[0].textContent = 'Sending...';

      // Hide previous messages
      successMessage.style.display = 'none';
      errorMessage.style.display = 'none';

      try {
        const formData = new FormData(form);
        
        const response = await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          body: formData
        });

        const data = await response.json();

        if (data.success) {
          // Show success message
          successMessage.style.display = 'block';
          successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
          
          // Reset form
          form.reset();
          
          // Reset date min attribute after form reset
          dateInput.setAttribute('min', today);
        } else {
          throw new Error('Form submission failed');
        }
      } catch (error) {
        console.error('Error:', error);
        errorMessage.style.display = 'block';
        errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
      } finally {
        // Reset button state
        submitBtn.disabled = false;
        loadingSpinner.style.display = 'none';
        submitBtn.childNodes[0].textContent = originalText;
      }
    });
  </script>
</MainLayout>